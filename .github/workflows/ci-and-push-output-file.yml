on: 
  push:
  schedule: # å®šæ—¶ä»»åŠ¡
  - cron: "0 2 * * *" # æ¯å¤©å‡Œæ™¨ 2 ç‚¹ï¼ˆUTCï¼‰æ—¶é—´è¿è¡Œã€‚æ¢ç®—æˆåŒ—äº¬æ—¶é—´å®é™…ä¸º 10 ç‚¹ï¼ˆæ—¶å·®ï¼š8å°æ—¶ï¼‰

permissions:
  contents: write

jobs:
  lint:
    name: ä»£ç æ£€æŸ¥ğŸ¦‹
    runs-on: ubuntu-latest

    steps:
      - name: æ‹‰å–ä»“åº“ä»£ç 
        uses: actions/checkout@v4

      - name: æ£€æŸ¥å‰ç«¯é¡¹ç›®ä»£ç 
        run: |
          cd ./seer-pets-website
          npm install
          npx prettier . --check
          npm run lint

      - name: æ£€æŸ¥è„šæœ¬é¡¹ç›®ä»£ç 
        run: |
          cd ./task-get-pets && npm install
          npx prettier . --check

  build:
    name: è¿è¡Œè„šæœ¬è¾“å‡ºæ–‡ä»¶å¹¶æäº¤åˆ°deployåˆ†æ”¯ğŸ¶
    runs-on: ubuntu-latest

    steps:
    - name: æŒ‡å®šnodeç‰ˆæœ¬
      uses: actions/setup-node@v4
      with:
        node-version: '22.12.0'

    - name: åˆ‡æ¢åˆ°deployåˆ†æ”¯æ‹‰å–ä»“åº“ä»£ç 
      uses: actions/checkout@v4
      with:
        ref: 'deploy'

    - name: å®‰è£…task-get-petsä¾èµ–
      run: cd ./task-get-pets && npm install
    
    - name: æ‰“åŒ…å¹¶æ‰§è¡Œè„šæœ¬è¾“å‡ºç²¾çµæ•°æ®æ–‡ä»¶
      run: |
        cd ./task-get-pets
        npm run build
        node ./dist/index.js
        cd ./dist/static && ls
    
    - name: å°†ç²¾çµå›¾é‰´è¾“å‡ºæ–‡ä»¶å¤åˆ¶åˆ°å‰ç«¯ç›®å½•ä¸­
      run: |
        cd ./task-get-pets
        cp ./dist/static/pets.json ../seer-pets-website/src/assets/pets.json
        cd ../seer-pets-website/src/assets && ls

    - name: å°†ç²¾çµå±æ€§å›¾é‰´è¾“å‡ºæ–‡ä»¶å¤åˆ¶åˆ°å‰ç«¯ç›®å½•ä¸­
      run: |
        cd ./task-get-pets
        cp ./dist/static/attributes.json ../seer-pets-website/src/assets/attributes.json
        cd ../seer-pets-website/src/assets && ls

    - name: é…ç½® Git ç”¨æˆ·ä¿¡æ¯
      run: |
        git config --global user.name "github-actions[bot]"
        git config --global user.email "github-actions[bot]@users.noreply.github.com"

    - name: å°†è¾“å‡ºä»£ç è‡ªåŠ¨æäº¤åˆ° deploy åˆ†æ”¯
      run: |
        git add .
        git commit -m "Automated commit: å°†çˆ¬è™«æ•°æ®æäº¤åˆ° deploy åˆ†æ”¯"
        git push origin deploy

