on: 
  push:
  schedule: # å®šæ—¶ä»»åŠ¡
  - cron: "0 2 * * *" # æ¯å¤©å‡Œæ™¨ 2 ç‚¹ï¼ˆUTCï¼‰æ—¶é—´è¿è¡Œã€‚æ¢ç®—æˆåŒ—äº¬æ—¶é—´å®é™…ä¸º 10 ç‚¹ï¼ˆæ—¶å·®ï¼š8å°æ—¶ï¼‰

permissions:
  contents: write

jobs:
  lint:
    name: ä»£ç æ£€æŸ¥ğŸ¦‹
    runs-on: ubuntu-latest

    steps:
      - name: æ‹‰å–ä»“åº“ä»£ç 
        uses: actions/checkout@v4

      - name: æ£€æŸ¥å‰ç«¯é¡¹ç›®ä»£ç 
        run: |
          cd ./seer-pets-website
          npm install
          npx prettier . --check
          npm run lint

      - name: æ£€æŸ¥è„šæœ¬é¡¹ç›®ä»£ç 
        run: |
          cd ./task-get-pets && npm install
          npx prettier . --check

  build:
    name: è¿è¡Œè„šæœ¬å¹¶éƒ¨ç½²åˆ° GitHub PagesğŸ¶
    runs-on: ubuntu-latest

    steps:
    - name: æŒ‡å®šnodeç‰ˆæœ¬
      uses: actions/setup-node@v4
      with:
        node-version: '22.12.0'

    - name: æ‹‰å–ä»“åº“ä»£ç 
      uses: actions/checkout@v4
      with:
        # The branch, tag or SHA to checkout. When checking out the repository that
        # triggered a workflow, this defaults to the reference or SHA for that event.
        # Otherwise, uses the default branch.
        ref: 'gh-pages'

    - name: å®‰è£…task-get-petsä¾èµ–
      run: cd ./task-get-pets && npm install
    
    - name: æ‰“åŒ…å¹¶æ‰§è¡Œè„šæœ¬è¾“å‡ºç²¾çµæ•°æ®æ–‡ä»¶
      run: |
        cd ./task-get-pets
        npm run build
        node ./dist/index.js
        cd ./dist/static && ls
    
    - name: å°†ç²¾çµå›¾é‰´è¾“å‡ºæ–‡ä»¶å¤åˆ¶åˆ°å‰ç«¯ç›®å½•ä¸­
      run: |
        cd ./task-get-pets
        cp ./dist/static/pets.json ../seer-pets-website/src/assets/pets.json
        cd ../seer-pets-website/src/assets && ls

    - name: å°†ç²¾çµå±æ€§å›¾é‰´è¾“å‡ºæ–‡ä»¶å¤åˆ¶åˆ°å‰ç«¯ç›®å½•ä¸­
      run: |
        cd ./task-get-pets
        cp ./dist/static/attributes.json ../seer-pets-website/src/assets/attributes.json
        cd ../seer-pets-website/src/assets && ls

    - name: é…ç½® Git ç”¨æˆ·ä¿¡æ¯
      run: |
        git config --global user.name "github-actions[bot]"
        git config --global user.email "github-actions[bot]@users.noreply.github.com"

    - name: å°†è¾“å‡ºä»£ç è‡ªåŠ¨æäº¤åˆ°ä»“åº“
      run: |
        git add .  # æ·»åŠ æ–‡ä»¶åˆ°æš‚å­˜åŒº
        git commit -m "Automated commit: Copy file to repository"
        git push origin $GITHUB_REF
      
    - name: å®‰è£…seer-pets-websiteä¾èµ–å¹¶æ‰“åŒ…å‰ç«¯é¡¹ç›®
      run: |
        cd ./seer-pets-website
        npm install
        npm run build

    - name: éƒ¨ç½²åˆ°github-pageä¸ŠğŸš€
      uses: JamesIves/github-pages-deploy-action@3.7.1
      with:
        BRANCH: gh-pages # æŠŠæ‰“åŒ…åçš„æ–‡ä»¶éƒ¨ç½²åˆ°gh-pagesåˆ†æ”¯ï¼Œè®°å¾—å¼€å¯github-page
        FOLDER: seer-pets-website/dist # è¿™é‡Œéœ€è¦åˆ¶å®šï¼Œé¡¹ç›®æ‰“åŒ…åçš„æ–‡ä»¶å¤¹